import { heading, paragraph, list, quote, codeBlock, hr, root } from '../lexical'

export interface PageData {
  title: string
  slug: string
  seoTitle: string
  seoDescription: string
  content: ReturnType<typeof root>
}

export const pagesData: PageData[] = [
  {
    title: 'Vibe Framework v4',
    slug: 'framework',
    seoTitle: 'Vibe Framework v4 — фреймворк вайбкодинга для Claude Code',
    seoDescription:
      'Vibe Framework v4 — полный фреймворк AI-разработки: философия Мозг+Руки, 4 уровня работы, Quality Gates, Anti-Mirage, 12 паттернов и шпаргалка.',
    content: root([
      paragraph(
        'Фреймворк как **мозг**, инструменты как **руки**. Описывает весь процесс создания проекта — от настройки сервера до деплоя.',
      ),
      quote('Автор: @CheatB | Версия: 4.1 | Февраль 2026'),

      // ─── Философия ───
      hr(),
      heading(2, '1. Философия: Мозг + Руки'),
      paragraph(
        'Ключевая идея фреймворка — разделение **что делать** и **как делать**. Мозг (фреймворк) описывает правила, workflow и решения. Руки (инструменты) выполняют конкретную работу: сканируют, форматируют, ревьюят, пишут код.',
      ),
      paragraph(
        'Чистый промпт-инжиниринг — это когда ты пишешь простыню текста в `CLAUDE.md` и надеешься, что модель всё запомнит. Проблемы: контекстное окно конечно, модель «забывает» правила в длинных сессиях, нет гарантий выполнения.',
      ),
      paragraph(
        '**Мозг + Руки** решает это: правила минимальны (ссылаются на инструменты), hooks работают автоматически, агенты подключаются по требованию, plugins дают доступ к реальным данным.',
      ),
      paragraph(
        'Выбор модели: **Opus думает** (архитектура, планирование, ревью — ~5x дороже), **Sonnet пишет** (реализация, тесты, субагенты — базовая цена), **Haiku проверяет** (простые правки, форматирование — ~10x дешевле).',
      ),

      // ─── 4 уровня ───
      hr(),
      heading(2, '2. Четыре уровня работы'),
      paragraph(
        'Каждая задача попадает в один из четырёх уровней. Уровень определяет глубину процесса, набор инструментов и количество проверок.',
      ),
      list([
        '**Проект** (дни/недели) — создание с нуля. 7 фаз: инфра, user-spec, tech-spec, декомпозиция, реализация, тестирование, финализация. Команда: `/new-project`',
        '**Эпик** (1-4 часа) — крупная функциональность. Планирование, декомпозиция на фичи, wave-параллелизм, интеграция, QA. PM + команда агентов',
        '**Фича** (15-60 мин) — одна конкретная возможность. Brainstorm, plan, approve, build блоками, test, review, commit. Команда: `/ship`',
        '**Фикс** (5-15 мин) — быстрое исправление. Определи, исправь, проверь. Команда: `/bug-fix`',
      ]),

      // ─── Карта инструментов ───
      hr(),
      heading(2, '3. Карта инструментов'),

      heading(3, 'Hooks — автоматические (14 штук)'),
      paragraph(
        'Hooks работают без участия человека, цепляясь к событиям Claude Code. Три типа триггеров: **PreToolUse** (до действия), **PostToolUse** (после действия), **Stop** (при завершении).',
      ),
      list([
        '`session-start.sh` — загрузка контекста при старте',
        '`security-scan.sh` — сканирование на SQLi, XSS при Write/Edit',
        '`protect-secrets.sh` — блокировка записи .env, токенов, паролей',
        '`backup-before-edit.sh` — бэкап файла перед редактированием',
        '`destructive-guard.sh` — блокировка `rm -rf`, `DROP TABLE`',
        '`conventional-commit.sh` — формат коммит-сообщения',
        '`branch-guard.sh` — блокировка push в main/master',
        '`prettier` / `python-lint.sh` — автоформатирование JS/TS и Python',
        '`reinject-context.sh` — восстановление контекста после compaction',
        '`cost-tracker.sh` — статистика сессии',
        '`code-simplifier` — упрощение кода после 3+ файлов',
      ]),

      heading(3, 'Plugins — расширения (10 штук)'),
      list([
        '`mgrep` — семантический поиск по кодовой базе',
        '`code-simplifier` — анализ сложности и упрощение кода',
        '`typescript-lsp` / `pyright-lsp` — типы, автодополнение, ошибки',
        '`context7` — актуальная документация библиотек',
        '`frontend-design` / `security-guidance` — UI/UX и безопасность',
        '`pr-review-toolkit` — инструменты для PR-ревью',
      ]),

      heading(3, 'Commands — слэш-команды (15 штук)'),
      list([
        '`/new-project` — полный пайплайн создания проекта (фазы 0-6)',
        '`/ship` — Feature pipeline: brainstorm, plan, build, test, commit',
        '`/deploy` — деплой на VPS через Docker',
        '`/done` — финализация: QA, документация, cost-tracker',
        '`/bug-fix` — режим Quick Fix',
        '`/tdd` — TDD-workflow: тесты, код, рефакторинг',
        '`/backlog` — управление бэклогом проекта',
        '`/code-review` / `/autoformat` / `/typecheck` / `/cleanup` — утилиты',
      ]),

      heading(3, 'Skills — навыки (10 штук)'),
      paragraph(
        'Специализированные SKILL.md: `new-project`, `docker-deploy`, `aiogram-bot`, `frontend-design`, `code-writing` (TDD-цикл), `feature-execution` (wave-параллелизм), `security-auditor` (OWASP), `infrastructure-setup`.',
      ),

      // ─── Quality Gates ───
      hr(),
      heading(2, '4. Quality Gates — система проверок'),
      paragraph(
        'Матрица проверок, привязанных к конкретным этапам. Часть работает автоматически (hooks), часть вызывается явно (agents).',
      ),
      list([
        '**Безопасность** — `security-scan.sh` + `security-auditor` при каждом Write/Edit',
        '**Защита секретов** — `protect-secrets.sh` при каждом Write/Edit',
        '**Форматирование** — `prettier` / `ruff` при каждом Write/Edit',
        '**Типизация** — `typescript-lsp` / `pyright-lsp` постоянно',
        '**Код-ревью** — `code-reviewer` после >20 строк нового кода',
        '**Anti-mirage** — `mgrep` / `reality-checker` перед ссылкой на файл',
      ]),
      paragraph(
        'Правило трёх попыток: максимум 3 итерации на каждом уровне валидации. После третьей — эскалация к человеку. Severity: Critical (обязательно исправить), Major (исправить), Minor (если быстро — исправить, иначе в техдолг).',
      ),

      // ─── Anti-Mirage ───
      hr(),
      heading(2, '5. Anti-Mirage — проверка реальности'),
      paragraph(
        'Claude любит «галлюцинировать» — ссылаться на несуществующие файлы, функции, API и пакеты. Anti-Mirage — набор правил, которые это предотвращают.',
      ),
      list([
        'Перед ссылкой на **файл** — `mgrep` или `ls`/`find`',
        'Перед вызовом **функции** — `mgrep "functionName"`',
        'Перед импортом **пакета** — проверить `package.json`/`pyproject.toml`',
        'Перед ссылкой на **поле БД** — проверить schema/migrations',
        'Перед использованием **API** — документация через `context7`',
      ]),
      paragraph(
        'Anti-mirage check **никогда не пропускается** — даже по команде skip review. Слишком дёшев и слишком ценен.',
      ),

      // ─── 12 паттернов ───
      hr(),
      heading(2, '6. Двенадцать паттернов вайбкодера'),
      list([
        '**Двунаправленная трассировка** — проверяй требования в обе стороны: forward (user-spec -> tech-spec) и reverse (tech-spec -> user-spec)',
        '**TDD-якоря** — описывай тесты уже на уровне tech-spec, не жди реализации',
        '**Context Files** — загружай только то, что нужно для конкретной задачи (экономия контекста)',
        '**Decisions.md** — записывай ПОЧЕМУ принял решение: контекст, альтернативы, последствия',
        '**Wave-параллелизм** — группируй задачи в волны, Sonnet-тиммейты параллельно, Opus-лид координирует',
        '**Максимум 3 итерации** — жёсткий лимит на любой цикл: валидация, ревью, auto-fix',
        '**Контекст после Compaction** — hook `reinject-context.sh` автоматически подгружает прогресс',
        '**Промпт = конкретика** — не «сделай авторизацию», а конкретный стек, файлы, модели',
        '**Cost-Awareness** — Sonnet для рутины, Opus для сложного, cost-tracker считает',
        '**Atomic Commits** — один коммит = одно логическое изменение, Conventional Commits',
        '**Бэклог вместо «потом»** — нерешённые вопросы, отложенные тесты, идеи — всё в бэклог',
        '**Глубинное интервью** — десятки вопросов от субагентов-аналитиков, а не поверхностный бриф',
      ], true),

      // ─── Auto-Fix Pipeline ───
      hr(),
      heading(2, '7. Auto-Fix Pipeline'),
      paragraph(
        'Автоматическое исправление ошибок в 4 уровня. Максимум 3 попытки на каждом. После — эскалация к человеку.',
      ),
      list([
        '**Level 1: Commit упал** — прочитай ошибку, исправь, коммить заново',
        '**Level 2: Push отклонён** — rebase на свежую main или создай PR',
        '**Level 3: CI/CD упал** — `gh run view --log-failed`, fix-коммит, push',
        '**Level 4: Деплой упал** — логи контейнера, fix, рестарт (если не помогло — revert)',
      ], true),

      // ─── Шпаргалка ───
      hr(),
      heading(2, '8. Быстрая шпаргалка'),
      codeBlock(
        '┌────────────────────────────────────────────────────────────────┐\n│                     УРОВЕНЬ ЗАДАЧИ                             │\n├──────────┬─────────┬──────────────┬────────────────────────────┤\n│  Фикс    │  Фича   │    Эпик      │       Проект               │\n│  5-15мин │ 15-60мин│   1-4часа    │      дни/недели            │\n├──────────┼─────────┼──────────────┼────────────────────────────┤\n│Определи  │Brainstor│Планирование  │Фаза 0: VPS + инфра         │\n│Исправь   │Plan Mode│Декомпозиция  │Фаза 1: User Spec (аналитик)│\n│Проверь   │Approve  │Wave-парал-зм │Фаза 2: Tech Spec (аналитик)│\n│Коммить   │Build    │Интеграция    │Фаза 3: Декомпозиция (waves)│\n│          │Test     │Тестирование  │Фаза 4: Реализация (team)   │\n│          │Review   │QA            │Фаза 5: Тестирование (14 т.)│\n│          │Commit   │              │Фаза 6: Финализация (deploy)│\n├──────────┼─────────┼──────────────┼────────────────────────────┤\n│/bug-fix  │/ship    │planner+      │        /new-project         │\n│0-1 агент │3-5 агент│PM + команда  │  (единая команда на всё)   │\n│Авто-hooks│+валидат.│Sonnet тиммейт│ Opus Lead + Sonnet         │\n└──────────┴─────────┴──────────────┴────────────────────────────┘\n\nБэклог: /backlog — всё, что "потом", живёт здесь',
        'text',
      ),

      // ─── Project Knowledge ───
      hr(),
      heading(2, '9. Project Knowledge'),
      paragraph(
        'Единый источник правды о проекте. 4 обязательных файла:',
      ),
      list([
        '**project.md** — что и зачем: назначение, проблема, аудитория, ключевые фичи, MVP scope',
        '**architecture.md** — как устроено: стек (+ ПОЧЕМУ), структура проекта, зависимости, модель данных',
        '**patterns.md** — как работаем: git workflow, стандарты кода, стратегия тестирования',
        '**deployment.md** — как деплоим: платформа, окружения, CI/CD, env vars, rollback',
      ]),
      paragraph(
        '`CLAUDE.md` — минимальный указатель: название, ветка, ссылка на Project Knowledge, ссылка на бэклог. НЕ простыня на 500 строк.',
      ),

      hr(),
      quote('Vibe Framework v4 — @CheatB — 2026. Фреймворк думает, инструменты работают.'),
    ]),
  },
]
