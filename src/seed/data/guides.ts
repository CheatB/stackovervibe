import { heading, paragraph, list, quote, codeBlock, hr, root } from '../lexical'

export interface GuideData {
  title: string
  slug: string
  excerpt: string
  pathOrder: number
  categorySlug: string
  seoTitle: string
  seoDescription: string
  content: ReturnType<typeof root>
}

export const guidesData: GuideData[] = [
  /* =====================================================
     1. Что такое вайбкодинг
     ===================================================== */
  {
    title: 'Что такое вайбкодинг',
    slug: 'chto-takoe-vajbkoding',
    excerpt:
      'Вайбкодинг — создание приложений с AI. Концепция Мозг+Руки, модели Opus/Sonnet/Haiku и что ожидать от процесса.',
    pathOrder: 1,
    categorySlug: 'osnovy',
    seoTitle: 'Что такое вайбкодинг — AI-программирование с Claude Code',
    seoDescription:
      'Вайбкодинг — создание приложений с помощью AI. Философия Мозг+Руки, выбор модели Opus/Sonnet/Haiku и первые шаги.',
    content: root([
      heading(2, 'Код без кода — как это работает'),
      paragraph(
        'Вайбкодинг — это когда ты создаёшь полноценные приложения, не написав ни строчки кода руками. Ты описываешь задачу, а AI-модель (Claude, GPT, Gemini) пишет код за тебя. Звучит как магия, но на практике это **система**: правильные промпты + правильные инструменты + правильный процесс.',
      ),
      paragraph(
        'Ты не заменяешь программиста — ты *становишься* программистом, у которого есть армия помощников. И как у любого нормального менеджера, твоя задача — **думать**, а не печатать.',
      ),

      heading(2, 'Принцип «Мозг + Руки»'),
      paragraph(
        'Ключевая идея Vibe Framework — разделение на **что делать** и **как делать**:',
      ),
      list([
        '**Мозг** (фреймворк) — живёт в `CLAUDE.md`, `rules/`, workflow-маркерах. Описывает ЧТО проверять, КОГДА запускать, КАКОЙ режим выбрать',
        '**Руки** (инструменты) — hooks, agents, plugins, skills, commands. Выполняют конкретную работу: сканируют, форматируют, ревьюят',
      ]),
      paragraph(
        'Чистый промпт-инжиниринг — это когда ты пишешь простыню текста и надеешься, что модель всё запомнит. Контекстное окно конечно, модель «забывает» правила в длинных сессиях, нет гарантий выполнения. **Мозг + Руки** решает это: правила минимальны и ссылаются на конкретные инструменты, hooks работают автоматически, агенты подключаются по требованию.',
      ),

      heading(2, 'Три уровня моделей'),
      paragraph('Не все задачи требуют одинаковой мощности. Три модели — три роли:'),
      list([
        '**Opus** — архитектура, планирование, сложная логика, ревью. Самая умная и самая дорогая (~5x дороже Sonnet)',
        '**Sonnet** — рутинная реализация, тесты, субагенты. Оптимальное соотношение цена/качество',
        '**Haiku** — простые правки, форматирование, быстрые проверки (~10x дешевле Sonnet)',
      ]),
      quote('Правило: Opus думает, Sonnet пишет, Haiku проверяет.'),

      heading(2, 'Чего ожидать (честно)'),
      paragraph(
        'Вайбкодинг — не «скажи AI и получи готовый продукт». Это итеративный процесс:',
      ),
      list([
        'Первая версия будет кривой — это нормально, итерируй',
        'AI ошибается и «галлюцинирует» — для этого есть Anti-Mirage проверки',
        'Чем точнее промпт, тем лучше результат — конкретика решает',
        'Тебе *придётся* разобраться в базовых концепциях: файлы, терминал, git, Docker, `.env`',
      ]),
      paragraph(
        'Каждую из этих тем можно освоить за вечер. Это не rocket science — это минимальный порог входа.',
      ),
    ]),
  },

  /* =====================================================
     2. Четыре уровня работы
     ===================================================== */
  {
    title: 'Четыре уровня работы',
    slug: 'chetyre-urovnya-raboty',
    excerpt:
      'Фикс, Фича, Эпик, Проект — четыре масштаба задач. Каждый определяет процесс, инструменты и глубину проверок.',
    pathOrder: 2,
    categorySlug: 'osnovy',
    seoTitle: 'Четыре уровня работы вайбкодера — от фикса до проекта',
    seoDescription:
      'Фикс (5 мин), Фича (15-60 мин), Эпик (часы), Проект (дни) — как выбрать уровень задачи и какой процесс запустить.',
    content: root([
      heading(2, 'Зачем нужны уровни'),
      paragraph(
        'Не каждая задача требует полной спецификации и команды агентов. Баг в одном файле и новый продукт с нуля — это разные вселенные. Уровень определяет **глубину процесса**, набор инструментов и количество проверок.',
      ),

      heading(2, 'Фикс — быстрое исправление'),
      paragraph('**Время:** 5-15 минут. **Команда:** `/bug-fix`'),
      paragraph(
        'Что-то сломалось — чини. Три шага: определи проблему, исправь, проверь. Никакого планирования, 0-1 агент. Скопируй полный стектрейс ошибки и отправь AI — не пересказывай своими словами, потеряешь детали.',
      ),

      heading(2, 'Фича — одна возможность'),
      paragraph('**Время:** 15-60 минут. **Команда:** `/ship`'),
      paragraph(
        'Основная единица работы. Процесс: Brainstorm → Plan → Approve → Build (блоками) → Test → Review → Commit. Работай блоками по 1-3 файла с чекпоинтами. Автоматический код-ревью после >20 строк.',
      ),
      quote(
        'Всегда проси Claude показать план ПЕРЕД реализацией. Это в 10 раз дешевле, чем переделывать код.',
      ),

      heading(2, 'Эпик — крупная функциональность'),
      paragraph('**Время:** 1-4 часа. **Инструменты:** PM + команда агентов'),
      paragraph(
        'Набор связанных фич. Пример: «Система авторизации» = регистрация + логин + восстановление пароля + профиль. Используется wave-параллелизм: задачи группируются в волны, независимые задачи выполняются параллельно через Agent Teams.',
      ),

      heading(2, 'Проект — создание с нуля'),
      paragraph('**Время:** дни/недели. **Команда:** `/new-project`'),
      paragraph(
        'Полный цикл из 7 фаз: инфраструктура → user-spec → tech-spec → декомпозиция → реализация → тестирование → финализация. Все агенты задействованы, включая бизнес-аналитика и системного аналитика.',
      ),

      heading(2, 'Как выбрать уровень'),
      list([
        '**Баг в одном файле** → Фикс',
        '**Новая кнопка, новый эндпоинт** → Фича',
        '**Система авторизации, переделка платежей** → Эпик',
        '**Новый продукт с нуля** → Проект',
      ]),
      paragraph(
        'Если не уверен — начни с Фичи. Если задача вырастает за пределы одного часа — повысь уровень до Эпика.',
      ),
    ]),
  },

  /* =====================================================
     3. Установка и настройка Claude Code
     ===================================================== */
  {
    title: 'Установка и настройка Claude Code',
    slug: 'ustanovka-i-nastrojka-claude-code',
    excerpt:
      'Пошаговая установка Claude Code CLI: Node.js, npm, API-ключ, первый запуск. Готовность за 10 минут.',
    pathOrder: 3,
    categorySlug: 'osnovy',
    seoTitle: 'Установка Claude Code CLI — настройка за 10 минут',
    seoDescription:
      'Пошаговая установка Claude Code: Node.js 20+, npm, создание API-ключа Anthropic, первый запуск и базовая настройка.',
    content: root([
      heading(2, 'Что понадобится'),
      list([
        '**macOS, Linux или WSL2** (Windows через WSL)',
        '**Node.js 18+** — рекомендуется 20 LTS',
        '**Аккаунт Anthropic** с доступом к Claude API',
        '**Терминал** — iTerm2, Terminal.app, любой',
      ]),

      heading(2, 'Шаг 1: Установка Node.js'),
      paragraph('Если Node.js ещё нет, установи через nvm (рекомендуется):'),
      codeBlock(
        'curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.0/install.sh | bash\nnvm install 20\nnvm use 20\nnode --version  # v20.x.x',
        'bash',
      ),

      heading(2, 'Шаг 2: Установка Claude Code'),
      codeBlock('npm install -g @anthropic-ai/claude-code', 'bash'),
      paragraph('Проверь установку:'),
      codeBlock('claude --version', 'bash'),

      heading(2, 'Шаг 3: Первый запуск'),
      paragraph('Создай директорию проекта и запусти Claude Code:'),
      codeBlock('mkdir my-project && cd my-project\nclaude', 'bash'),
      paragraph(
        'Claude Code попросит авторизоваться через Anthropic аккаунт. Следуй инструкциям в терминале — откроется браузер для подтверждения.',
      ),

      heading(2, 'Шаг 4: Настройка CLAUDE.md'),
      paragraph(
        '`CLAUDE.md` — главный конфиг проекта. Claude читает его при каждом запуске. Создай в корне проекта:',
      ),
      codeBlock(
        '# Мой проект\n\nОписание: бот для учёта расходов.\n\n## Стек\n- Python + aiogram v3\n- PostgreSQL\n- Docker + VPS\n\n## Правила\n- Код и комментарии на русском\n- Conventional commits (feat/fix/refactor)\n- Тесты обязательны',
        'markdown',
      ),

      heading(2, 'Шаг 5: Глобальные настройки'),
      paragraph(
        'Для настроек, общих для всех проектов, создай `~/.claude/CLAUDE.md`:',
      ),
      codeBlock('mkdir -p ~/.claude\ntouch ~/.claude/CLAUDE.md', 'bash'),
      paragraph(
        'В глобальном файле укажи: кто ты, какой стек предпочитаешь, язык, стиль общения. Claude будет помнить это во всех проектах.',
      ),

      heading(2, 'Проверка и типичные проблемы'),
      list([
        '**`command not found: claude`** — убедись, что npm глобальные пакеты в PATH. Попробуй `npx claude`',
        '**`Authentication failed`** — перелогинься командой `claude auth login`',
        '**CLAUDE.md не читается** — файл должен лежать в корне проекта, рядом с `package.json`',
        '**Медленная работа** — проверь интернет. Модель Opus работает медленнее Sonnet — для рутины переключись на Sonnet',
      ]),
    ]),
  },

  /* =====================================================
     4. Настройка фреймворка: правила и хуки
     ===================================================== */
  {
    title: 'Настройка фреймворка: правила и хуки',
    slug: 'nastrojka-frejmvorka-pravila-i-huki',
    excerpt:
      'CLAUDE.md, директория rules/, 14 типов хуков, settings.json — полная настройка фреймворка для продуктивной работы.',
    pathOrder: 4,
    categorySlug: 'osnovy',
    seoTitle: 'Настройка фреймворка Claude Code — хуки, правила, плагины',
    seoDescription:
      'Настройка CLAUDE.md, rules/, hooks (14 типов), settings.json и плагинов. Автоматизация Claude Code с первого дня.',
    content: root([
      heading(2, 'Три слоя настройки'),
      paragraph('Claude Code настраивается на трёх уровнях:'),
      list([
        '**Глобальный** (`~/.claude/`) — общие правила для всех проектов',
        '**Проектный** (`.claude/` в корне проекта) — настройки конкретного проекта',
        '**Сессионный** — настройки текущей сессии через промпт или slash-команды',
      ]),

      heading(2, 'Хуки — автоматические скрипты'),
      paragraph(
        'Хуки — это скрипты, которые запускаются на события Claude Code. Ты их не вызываешь — они работают сами. Настраиваются в `.claude/settings.json`:',
      ),
      codeBlock(
        '{\n  "hooks": {\n    "PostToolUse": [\n      {\n        "matcher": "Write|Edit",\n        "command": "prettier --write $FILEPATH"\n      }\n    ],\n    "PreToolUse": [\n      {\n        "matcher": "Bash",\n        "command": "bash .claude/hooks/destructive-guard.sh"\n      }\n    ]\n  }\n}',
        'json',
      ),
      paragraph('Основные триггеры хуков:'),
      list([
        '**PreToolUse** — перед выполнением инструмента (блокировка деструктивных команд, бэкап файла)',
        '**PostToolUse** — после выполнения (автоформатирование, security-scan)',
        '**Stop** — при завершении сессии (отчёты, уведомления, проверка debug-кода)',
        '**Notification** — при событиях вроде compaction (восстановление контекста)',
      ]),

      heading(2, 'Правила — файлы в rules/'),
      paragraph(
        'Правила живут в `rules/*.md`. Claude читает их и следует. Начни с двух обязательных:',
      ),
      list([
        '**anti-mirage.md** — проверка реальности: все файлы, функции и пакеты, на которые ссылается AI, реально существуют',
        '**coding-standards.md** — стандарты кода: DRY, KISS, YAGNI, размеры файлов и функций',
      ]),

      heading(2, 'Плагины — MCP-серверы'),
      paragraph(
        'Плагины дают Claude доступ к внешним инструментам. Подключаются глобально в `~/.claude/settings.json`:',
      ),
      codeBlock(
        '{\n  "mcpServers": {\n    "context7": {\n      "command": "npx",\n      "args": ["-y", "@context7/mcp-server"]\n    }\n  }\n}',
        'json',
      ),
      paragraph('Рекомендуемые на старте:'),
      list([
        '**context7** — актуальная документация библиотек (вместо устаревших данных из обучения модели)',
        '**typescript-lsp** / **pyright-lsp** — типы и ошибки в реальном времени',
        '**mgrep** — семантический поиск по кодовой базе',
      ]),

      heading(2, 'Минимальная конфигурация на старте'),
      paragraph('Не перенастраивай. Для начала достаточно:'),
      list([
        '`CLAUDE.md` в корне проекта — описание, стек, 5-7 ключевых правил',
        '2-3 хука — prettier, security-scan, conventional-commit',
        '1-2 правила — anti-mirage обязателен, coding-standards по желанию',
        '1 плагин — context7 для актуальных доков',
      ]),
      paragraph(
        'Добавляй инструменты по мере необходимости. 5 рабочих хуков лучше, чем 50 настроенных криво.',
      ),
    ]),
  },

  /* =====================================================
     5. Первый проект от нуля до деплоя
     ===================================================== */
  {
    title: 'Первый проект от нуля до деплоя',
    slug: 'pervyj-proekt-ot-nulya-do-deploya',
    excerpt:
      'Создаём первый проект: 7 фаз от подготовки VPS до деплоя. Пошаговый процесс с командой /new-project.',
    pathOrder: 5,
    categorySlug: 'osnovy',
    seoTitle: 'Первый проект на Claude Code — от нуля до деплоя',
    seoDescription:
      'Пошаговое создание проекта: Фаза 0 (VPS) → User Spec → Tech Spec → задачи → реализация → тесты → деплой.',
    content: root([
      heading(2, 'Обзор: 7 фаз'),
      paragraph(
        'Весь процесс запускается командой `/new-project` и идёт непрерывным потоком. Между фазами нет ручного переключения — AI сам определяет готовность, показывает результат и переходит дальше.',
      ),
      list([
        '**Фаза 0** — Подготовка инфраструктуры (VPS, Docker, Nginx)',
        '**Фаза 1** — Пользовательская спецификация (User Spec)',
        '**Фаза 2** — Техническая спецификация (Tech Spec)',
        '**Фаза 3** — Декомпозиция на задачи (Tasks + Waves)',
        '**Фаза 4** — Реализация (TDD-цикл, блоки с чекпоинтами)',
        '**Фаза 5** — Тестирование (до 14 типов тестов)',
        '**Фаза 6** — Финализация (QA + Deploy + Docs)',
      ], true),

      heading(2, 'Фаза 0: Инфраструктура'),
      paragraph(
        'Поднять VPS, настроить безопасность, Docker, Nginx + SSL, CI/CD. Можно пропустить, если сервер уже настроен.',
      ),
      codeBlock(
        '# Базовая безопасность VPS\nufw default deny incoming\nufw allow ssh\nufw allow 80/tcp\nufw allow 443/tcp\nufw enable',
        'bash',
      ),

      heading(2, 'Фазы 1-2: Спецификации'),
      paragraph(
        'Субагент **business-analyst** проводит глубинное интервью: 7 циклов вопросов от общего понимания проекта до edge-cases. Результат — `user-spec.md`. Затем **system-analyst** формирует техническую архитектуру — `tech-spec.md`. Оба документа проходят валидацию несколькими валидаторами параллельно.',
      ),

      heading(2, 'Фаза 3: Декомпозиция'),
      paragraph(
        'Tech-spec разбивается на атомарные задачи. Каждая содержит: описание, пошаговый план, TDD-якорь (тесты до кода), acceptance criteria. Задачи группируются в **волны** по зависимостям.',
      ),

      heading(2, 'Фаза 4: Реализация'),
      paragraph(
        'Два режима: последовательный (один агент) или командный (Agent Teams с wave-параллелизмом). На каждую задачу — TDD-цикл: напиши тесты → запусти (красные) → напиши код → запусти (зелёные) → рефакторинг.',
      ),

      heading(2, 'Фаза 5: Тестирование'),
      paragraph(
        'AI анализирует проект и выбирает нужные типы тестов. Обязательные для любого проекта: smoke, unit, integration, security, regression, UAT. Остальные — по ситуации.',
      ),

      heading(2, 'Фаза 6: Финализация'),
      paragraph(
        'QA (тесты + линтер + тайпчек + security scan), деплой (Docker-образ, миграции, мониторинг), post-deploy проверка (приложение отвечает, логи чистые), обновление документации.',
      ),

      heading(2, 'Советы для первого раза'),
      list([
        '**Начни с малого** — Telegram-бот, лендинг, простое API. Не Netflix',
        '**Коммить часто** — каждый рабочий блок = коммит. Это страховка',
        '**Не оптимизируй раньше времени** — сначала пусть работает',
        '**Если всё сломалось** — `git log`, найди последний рабочий коммит, откатись',
      ]),
    ]),
  },

  /* =====================================================
     6. Работа с агентами и командами
     ===================================================== */
  {
    title: 'Работа с агентами и командами',
    slug: 'rabota-s-agentami-i-komandami',
    excerpt:
      'Субагенты Claude Code: валидаторы, ревьюеры, исполнители. Agent Teams, wave-параллелизм и команда /ship.',
    pathOrder: 6,
    categorySlug: 'osnovy',
    seoTitle: 'Агенты и команды Claude Code — субагенты и параллелизм',
    seoDescription:
      'Каталог субагентов Claude Code: бизнес-аналитик, code-reviewer, security-auditor. Agent Teams и wave-параллелизм.',
    content: root([
      heading(2, 'Зачем нужны субагенты'),
      paragraph(
        'Один AI-агент — это бутылочное горлышко. Он может писать код, проверять безопасность, ревьюить и тестировать, но не всё сразу и не параллельно. Субагенты решают эту проблему: каждый специализируется на своей задаче.',
      ),

      heading(2, 'Каталог субагентов'),

      heading(3, 'Фазовые — специальные роли'),
      list([
        '**business-analyst** — глубинное интервью, 7 циклов вопросов, предлагает варианты ответов (Фаза 1)',
        '**system-analyst** — технические вопросы, выбор стека, модель данных (Фаза 2)',
      ]),

      heading(3, 'Валидаторы'),
      list([
        '**skeptic** — детектор «миражей»: несуществующих файлов, функций, API',
        '**completeness-validator** — двунаправленная трассировка user-spec и tech-spec',
        '**task-validator** — атомарность, согласованность и шаблон задач',
        '**reality-checker** — существование файлов, реализуемость зависимостей',
      ]),

      heading(3, 'Код-ревьюеры'),
      list([
        '**code-reviewer** — 10-мерный анализ: корректность, безопасность, производительность, читаемость, DRY, SOLID',
        '**security-auditor** — OWASP Top 10, хардкод секретов, уязвимости',
        '**test-reviewer** — качество тестов: покрытие, edge cases',
      ]),

      heading(3, 'Исполнители'),
      list([
        '**task-creator** — генерирует файлы задач из tech-spec',
        '**tdd-guide** — ведёт TDD-цикл: тесты → код → рефакторинг',
        '**build-error-resolver** — диагностика и исправление ошибок сборки',
      ]),

      heading(2, 'Agent Teams: параллельная работа'),
      paragraph(
        'Для эпиков и крупных фич используй Agent Teams:',
      ),
      list([
        '**Team Lead** (Opus) — читает tech-spec, строит execution plan, координирует',
        '**Teammates** (Sonnet) — выполняют конкретные задачи параллельно, каждый со своим контекстом',
        'Lead собирает результаты, запускает интеграционные проверки, переходит к следующей волне',
      ]),

      heading(2, 'Wave-параллелизм'),
      paragraph('Задачи группируются в волны по зависимостям:'),
      codeBlock(
        'Wave 1: Модели и миграции (фундамент)\n  task-001, task-002 [параллельно]\n\nWave 2: Бизнес-логика\n  task-003, task-004 [параллельно]\n\nWave 3: API и хендлеры\n  task-005, task-006 [параллельно]\n\nWave 4: Тесты + QA\n  task-007 [последовательно]',
        'text',
      ),
      paragraph(
        'Задачи внутри одной волны независимы — их можно запускать параллельно. Следующая волна начинается только после завершения предыдущей.',
      ),
      quote(
        'Экономия: Teammates на Sonnet стоят ~5x дешевле, чем если бы всё делал Opus. Lead координирует, рутину делегирует.',
      ),
    ]),
  },

  /* =====================================================
     7. Quality Gates и Anti-Mirage
     ===================================================== */
  {
    title: 'Quality Gates и Anti-Mirage',
    slug: 'quality-gates-i-anti-mirage',
    excerpt:
      'Автоматические проверки качества, правило трёх попыток и защита от галлюцинаций AI. Матрица: что, чем, когда.',
    pathOrder: 7,
    categorySlug: 'osnovy',
    seoTitle: 'Quality Gates и Anti-Mirage — проверка качества AI-кода',
    seoDescription:
      'Quality Gates: матрица проверок, severity-уровни, правило 3 попыток. Anti-Mirage: типы галлюцинаций AI и как их ловить.',
    content: root([
      heading(2, 'Quality Gates — система проверок'),
      paragraph(
        'Каждый gate привязан к конкретному инструменту. Часть работает автоматически (hooks), часть вызывается явно. Задача — не пропустить проблему на следующий этап.',
      ),

      heading(3, 'Автоматические проверки (hooks)'),
      list([
        '**security-scan.sh** — сканирует код на SQLi, XSS, инъекции при каждом Write/Edit',
        '**protect-secrets.sh** — блокирует запись `.env`, токенов, паролей в код',
        '**destructive-guard.sh** — блокирует `rm -rf`, `DROP TABLE` и подобное в Bash',
        '**prettier / ruff** — автоформатирование JS/TS и Python после каждого изменения',
        '**typescript-lsp / pyright-lsp** — проверка типов в реальном времени',
        '**code-simplifier** — анализ и упрощение после 3+ изменённых файлов',
      ]),

      heading(3, 'Проверки по вызову'),
      list([
        '**code-reviewer** — 10-мерный ревью после >20 строк нового кода',
        '**security-auditor** — OWASP-аудит для security-sensitive кода (авторизация, платежи)',
        '**5 валидаторов параллельно** — для user-spec и tech-spec на уровне Проекта',
      ]),

      heading(3, 'Severity — уровни серьёзности'),
      list([
        '**Critical** — обязательно исправить. Ре-верификация после исправления',
        '**Major** — исправить. Не блокирует, но нужно',
        '**Minor** — исправить если быстро (<2 мин), иначе записать как техдолг',
      ]),

      heading(3, 'Правило трёх попыток'),
      paragraph(
        'Жёсткий лимит на любой цикл: валидация, ревью, auto-fix. Итерация 1: валидация → findings → fix. Итерация 2: ре-валидация → findings → fix. Итерация 3: финальная → если ещё есть issues → эскалация к человеку.',
      ),
      quote('Лучше ложно-положительное, чем ложно-отрицательное. Проверенная ошибка дешевле пропущенной.'),

      hr(),

      heading(2, 'Anti-Mirage — проверка реальности'),
      paragraph(
        'Claude любит «галлюцинировать» — ссылаться на несуществующие файлы, функции, API и пакеты. Это самая частая причина ошибок при AI-разработке. Anti-Mirage — набор правил, которые это предотвращают.',
      ),

      heading(3, 'Типичные миражи'),
      list([
        '**Несуществующий файл** — «Отредактируй `src/utils/helpers.py`» (его нет в проекте)',
        '**Несуществующая функция** — «Вызови `user.get_full_name()`» (метод называется `get_name`)',
        '**Устаревший API** — «Используй `requests.get_async()`» (такого метода нет)',
        '**Фантомный пакет** — «Установи `fastapi-cache3`» (не существует в PyPI)',
        '**Фантомное поле БД** — «`WHERE user.role = "admin"`» (поля `role` нет в схеме)',
      ]),

      heading(3, 'Как проверять'),
      list([
        'Перед ссылкой на файл — `ls` или `find`',
        'Перед вызовом функции — `mgrep "functionName"` по кодовой базе',
        'Перед импортом пакета — проверь `package.json` / `pyproject.toml`',
        'Перед ссылкой на поле БД — проверь schema / migrations',
        'Перед использованием API — проверь документацию через `context7`',
      ]),
      paragraph(
        'Anti-Mirage — самая дешёвая и самая ценная проверка. Не пропускай её даже для Quick Fix.',
      ),
    ]),
  },

  /* =====================================================
     8. Паттерны опытного вайбкодера
     ===================================================== */
  {
    title: 'Паттерны опытного вайбкодера',
    slug: 'patterny-opytnogo-vajbkodera',
    excerpt:
      '12 паттернов продуктивной работы: трассировка требований, TDD-якоря, atomic commits, cost-awareness и бэклог.',
    pathOrder: 8,
    categorySlug: 'osnovy',
    seoTitle: 'Паттерны вайбкодера — 12 лучших практик Claude Code',
    seoDescription:
      '12 паттернов опытного вайбкодера: трассировка требований, TDD-якоря, decisions.md, wave-параллелизм, atomic commits.',
    content: root([
      heading(2, '12 паттернов, которые отличают новичка от про'),

      heading(3, '1. Двунаправленная трассировка'),
      paragraph(
        'Проверяй в обе стороны: **Forward** — каждое требование из user-spec отражено в tech-spec? Ничего не потеряли? **Reverse** — каждая задача в tech-spec обоснована требованием? Нет ли лишнего?',
      ),

      heading(3, '2. TDD-якоря в спецификациях'),
      paragraph(
        'Не жди фазы реализации — опиши тесты уже на уровне tech-spec. Это направляет реализацию и экономит часы:',
      ),
      codeBlock(
        '## Task: Регистрация пользователя\n\n### TDD-якорь:\n- test_register_creates_user\n- test_register_duplicate_email → 409\n- test_register_weak_password → 400',
        'markdown',
      ),

      heading(3, '3. Context Files — загрузка по требованию'),
      paragraph(
        'Не грузи всё — грузи только то, что нужно для конкретной задачи. Каждая задача содержит список `Context Files`. Экономит контекстное окно и улучшает фокус модели.',
      ),

      heading(3, '4. Decisions.md — лог решений'),
      paragraph(
        'Записывай ПОЧЕМУ принял решение: контекст, альтернативы, выбор, последствия. Через 3 месяца не вспомнишь без записи. Это спасёт тебя (и твоего будущего AI-агента).',
      ),

      heading(3, '5. Wave-параллелизм'),
      paragraph(
        'Группируй задачи в волны по зависимостям. Субагенты на Sonnet работают параллельно внутри волны, Lead на Opus координирует переходы между волнами.',
      ),

      heading(3, '6. Правило трёх попыток'),
      paragraph(
        'Жёсткий лимит на любой цикл: валидация, ревью, auto-fix. После трёх итераций — эскалация к человеку. Не позволяй AI крутиться в бесконечном цикле.',
      ),

      heading(3, '7. Контекст после Compaction'),
      paragraph(
        'В длинных сессиях контекст сжимается. Hook `reinject-context.sh` автоматически подгружает текущую задачу, активные файлы и прогресс. Настрой его — и не потеряешь нить.',
      ),

      heading(3, '8. Промпт = конкретика'),
      paragraph(
        'Плохо: «Сделай авторизацию». Хорошо: конкретный стек, файлы, формат токенов, модели, пути, примеры ввода/вывода. Чем конкретнее промпт, тем меньше итераций.',
      ),

      heading(3, '9. Cost-Awareness'),
      paragraph(
        'Sonnet для рутины (~5x дешевле), Opus для сложного. Не грузи лишний контекст. Hook `cost-tracker.sh` считает стоимость каждой сессии — следи за цифрами.',
      ),

      heading(3, '10. Atomic Commits'),
      paragraph(
        'Один коммит = одно логическое изменение. Conventional Commits: `feat:`, `fix:`, `test:`, `refactor:`, `docs:`. Если надо откатить — откатишь только нужное.',
      ),

      heading(3, '11. Бэклог вместо «потом сделаю»'),
      paragraph(
        'Всё, что «потом» — в бэклог. Нерешённый вопрос, отложенный тест, идея на будущее — записывай через `/backlog add`. Ничего не теряется, и AI может вернуться к задаче в любой момент.',
      ),

      heading(3, '12. Глубинное интервью вместо поверхностного брифа'),
      paragraph(
        'Субагенты business-analyst и system-analyst задают десятки вопросов, а не 3-4. Это дорого по токенам, но на порядок дешевле, чем переделывать проект после «забытых» требований.',
      ),

      hr(),

      paragraph(
        'Эти паттерны не нужно применять все сразу. Начни с atomic commits и промпт-конкретики, а остальные подключай по мере роста проектов.',
      ),
    ]),
  },
]
