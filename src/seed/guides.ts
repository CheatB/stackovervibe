import { heading, paragraph, list, quote, codeBlock, hr, root } from './lexical'

/** Тип данных гайда для seed */
export interface GuideData {
  title: string
  slug: string
  excerpt: string
  pathOrder: number
  categorySlug: string
  content: ReturnType<typeof root>
}

/* =====================================================
   ПУТЬ НОВИЧКА — 6 гайдов (pathOrder 1-6)
   ===================================================== */

const путьНовичка: GuideData[] = [
  {
    title: 'Что такое вайбкодинг',
    slug: 'chto-takoe-vajbkoding',
    excerpt: 'Вайбкодинг — создание приложений с помощью AI. Ты думаешь, AI пишет код. Разбираемся, как это работает.',
    pathOrder: 1,
    categorySlug: 'put-novichka',
    content: root([
      heading(2, 'Что вообще происходит'),
      paragraph('Вайбкодинг — это когда ты создаёшь полноценные приложения, не написав ни строчки кода руками. Ты описываешь, что хочешь, а AI-модель (Claude, GPT, Gemini) пишет код за тебя.'),
      paragraph('Звучит как магия, но на практике это **система**: правильные промпты + правильные инструменты + правильный процесс.'),

      heading(2, 'Принцип «Мозг + Руки»'),
      paragraph('Ключевая идея вайбкодинга — разделение на **что делать** и **как делать**:'),
      list([
        '**Мозг** (ты) — решаешь, что строить, какую архитектуру выбрать, какие фичи важны',
        '**Руки** (AI) — пишет код, тесты, конфиги, деплоит',
      ]),
      paragraph('Ты не заменяешь программиста — ты *становишься* программистом, у которого есть армия помощников.'),

      heading(2, 'Что нужно знать'),
      paragraph('Хорошая новость: тебе **не нужно** уметь программировать, чтобы начать. Плохая новость: тебе *придётся* разобраться в базовых концепциях:'),
      list([
        'Что такое **файлы и директории** (структура проекта)',
        'Что такое **терминал** (команды, git, npm)',
        'Что такое **переменные окружения** (.env файлы)',
        'Что такое **Docker** (контейнеры для запуска приложений)',
        'Как работает **git** (сохранение и отправка кода)',
      ]),
      paragraph('Это не rocket science. Каждую из этих тем можно освоить за вечер.'),

      heading(2, 'Какие модели использовать'),
      paragraph('Три уровня AI-моделей для разных задач:'),
      list([
        '**Opus** — думает, планирует, принимает архитектурные решения (самая дорогая)',
        '**Sonnet** — пишет код, рутинная реализация (оптимальное соотношение цена/качество)',
        '**Haiku** — простые правки, форматирование, быстрые проверки (самая дешёвая)',
      ]),
      quote('Правило: Opus думает, Sonnet пишет, Haiku проверяет.'),

      heading(2, 'Чего ожидать'),
      paragraph('Вайбкодинг — это не «скажи AI и получи готовый продукт». Это итеративный процесс:'),
      list([
        'Первая версия будет кривой — это нормально',
        'AI ошибается и «галлюцинирует» — нужны проверки',
        'Чем точнее промпт, тем лучше результат',
        'Со временем ты выработаешь свой стиль и набор инструментов',
      ]),

      heading(2, 'Частые проблемы'),
      list([
        '**«AI написал бред»** — скорее всего, промпт был слишком общим. Давай конкретику: файлы, формат, примеры',
        '**«Код не работает»** — копируй полный стектрейс ошибки и отправляй AI. Не пересказывай своими словами',
        '**«Не знаю, с чего начать»** — начни с малого. Бот в Telegram, лендинг, простое API. Не пытайся строить Netflix',
      ]),

      heading(2, 'Следующий шаг'),
      paragraph('Теперь, когда ты понимаешь концепцию, пора выбрать инструменты. Переходи к следующему шагу — **Выбор инструментов**.'),
    ]),
  },

  {
    title: 'Выбор инструментов',
    slug: 'vybor-instrumentov',
    excerpt: 'Обзор инструментов вайбкодера: Claude Code, хуки, плагины, скиллы. Что для чего и что нужно на старте.',
    pathOrder: 2,
    categorySlug: 'put-novichka',
    content: root([
      heading(2, 'Карта инструментов'),
      paragraph('Весь арсенал вайбкодера делится на 5 категорий. Не нужно изучать всё сразу — начни с базы и добавляй по мере необходимости.'),

      heading(3, 'Скиллы (Skills)'),
      paragraph('Готовые «навыки» для Claude Code. Каждый скилл — это SKILL.md файл с инструкциями, примерами и workflow. Claude читает его и знает, как выполнять задачу.'),
      list([
        '`new-project` — создание нового проекта с нуля',
        '`docker-deploy` — деплой на VPS через Docker',
        '`code-writing` — TDD-цикл: тесты → код → ревью',
        '`aiogram-bot` — Telegram-боты на Aiogram v3',
        '`security-auditor` — аудит безопасности по OWASP',
      ]),

      heading(3, 'Команды (Commands)'),
      paragraph('Слэш-команды, которые ты вводишь в Claude Code. Каждая запускает определённый процесс:'),
      list([
        '`/ship` — полный pipeline фичи: brainstorm → план → код → тесты → коммит',
        '`/deploy` — деплой на VPS',
        '`/test` — запуск тестов с TDD-подходом',
        '`/code-review` — ревью кода',
        '`/status` — статус проекта: git, Docker, ошибки',
      ]),

      heading(3, 'Хуки (Hooks)'),
      paragraph('Автоматические скрипты, которые запускаются на события Claude Code. Ты их не вызываешь — они работают сами:'),
      list([
        '`security-scan.sh` — проверка безопасности при каждом изменении файла',
        '`prettier` — автоформатирование JS/TS',
        '`conventional-commit.sh` — проверка формата коммит-сообщения',
        '`protect-secrets.sh` — блокировка записи секретов в код',
      ]),

      heading(3, 'Правила (Rules)'),
      paragraph('Файлы в `rules/` директории, которые Claude читает и следует. Определяют поведение на уровне проекта:'),
      list([
        '`coding-standards.md` — стандарты кода',
        '`security.md` — правила безопасности',
        '`anti-mirage.md` — проверка реальности (против галлюцинаций AI)',
      ]),

      heading(3, 'Плагины (Plugins)'),
      paragraph('MCP-серверы, которые дают Claude доступ к внешним инструментам:'),
      list([
        '`context7` — актуальная документация библиотек',
        '`typescript-lsp` — типы и ошибки TypeScript',
        '`mgrep` — семантический поиск по кодовой базе',
      ]),

      heading(2, 'Что нужно на старте'),
      paragraph('Для первого проекта достаточно:'),
      list([
        '**Claude Code** (CLI) — основной инструмент',
        '**2-3 скилла** — `new-project`, `docker-deploy`, один по твоему стеку',
        '**Базовые хуки** — `security-scan`, `prettier`, `conventional-commit`',
        '**Правило** `anti-mirage` — защита от галлюцинаций',
      ]),
      paragraph('Остальное добавишь, когда почувствуешь потребность.'),

      heading(2, 'Частые проблемы'),
      list([
        '**«Слишком много инструментов, не знаю что выбрать»** — начни только с Claude Code и скилла `new-project`. Этого хватит',
        '**«Хуки не работают»** — проверь, что они прописаны в `.claude/settings.json` проекта',
        '**«Плагин не отвечает»** — перезапусти Claude Code, проверь MCP конфиг',
      ]),
    ]),
  },

  {
    title: 'Установка Claude Code',
    slug: 'ustanovka-claude-code',
    excerpt: 'Пошаговая установка Claude Code: Node.js, npm, первый запуск, настройка CLAUDE.md. Готовность за 10 минут.',
    pathOrder: 3,
    categorySlug: 'put-novichka',
    content: root([
      heading(2, 'Что понадобится'),
      list([
        '**macOS, Linux или WSL2** (Windows через WSL)',
        '**Node.js 18+** — рекомендуется 20 LTS',
        '**Аккаунт Anthropic** с доступом к Claude',
        '**Терминал** — iTerm2, Terminal.app, любой',
      ]),

      heading(2, 'Шаг 1: Установка Node.js'),
      paragraph('Если Node.js ещё нет, установи через nvm (рекомендуется):'),
      codeBlock('curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.0/install.sh | bash\nnvm install 20\nnvm use 20\nnode --version  # должно показать v20.x.x', 'bash'),

      heading(2, 'Шаг 2: Установка Claude Code'),
      codeBlock('npm install -g @anthropic-ai/claude-code', 'bash'),
      paragraph('Проверь установку:'),
      codeBlock('claude --version', 'bash'),

      heading(2, 'Шаг 3: Первый запуск'),
      paragraph('Перейди в директорию проекта (или создай новую) и запусти:'),
      codeBlock('mkdir my-project && cd my-project\nclaude', 'bash'),
      paragraph('Claude Code попросит авторизоваться через Anthropic аккаунт. Следуй инструкциям в терминале.'),

      heading(2, 'Шаг 4: Настройка CLAUDE.md'),
      paragraph('`CLAUDE.md` — главный файл настроек проекта. Claude читает его при каждом запуске. Создай в корне проекта:'),
      codeBlock('# Мой проект\n\nОписание: что делает проект, одной строкой.\n\n## Стек\n- Backend: Node.js + Express\n- БД: PostgreSQL\n- Деплой: Docker + VPS\n\n## Правила\n- Код и комментарии на русском\n- Conventional commits (feat/fix/refactor)\n- Тесты обязательны', 'markdown'),

      heading(2, 'Шаг 5: Глобальные настройки'),
      paragraph('Для настроек, общих для всех проектов, создай файл `~/.claude/CLAUDE.md`:'),
      codeBlock('mkdir -p ~/.claude\ntouch ~/.claude/CLAUDE.md', 'bash'),
      paragraph('В глобальном CLAUDE.md указывай: кто ты, какой стек предпочитаешь, язык, стиль общения.'),

      heading(2, 'Проверка'),
      paragraph('Запусти Claude Code и попробуй:'),
      list([
        'Напиши `hello` — Claude должен ответить',
        'Попроси создать файл — должен создаться',
        'Попроси прочитать CLAUDE.md — должен знать правила проекта',
      ]),

      heading(2, 'Частые проблемы'),
      list([
        '**«command not found: claude»** — убедись, что npm глобальные пакеты в PATH. Попробуй `npx claude`',
        '**«Authentication failed»** — перелогинься: `claude auth login`',
        '**«CLAUDE.md не читается»** — файл должен быть в корне проекта, рядом с `package.json`',
        '**Медленная работа** — проверь интернет-соединение, модель Opus работает медленнее Sonnet',
      ]),
    ]),
  },

  {
    title: 'Настройка окружения',
    slug: 'nastrojka-okruzheniya',
    excerpt: 'Хуки, правила, плагины — базовая настройка Claude Code для продуктивной работы. Автоматизация с первого дня.',
    pathOrder: 4,
    categorySlug: 'put-novichka',
    content: root([
      heading(2, 'Три слоя настройки'),
      paragraph('Claude Code настраивается на трёх уровнях:'),
      list([
        '**Глобальный** (`~/.claude/`) — общие правила для всех проектов',
        '**Проектный** (`.claude/` в корне проекта) — настройки конкретного проекта',
        '**Сессионный** — настройки текущей сессии (через промпт)',
      ]),

      heading(2, 'Настройка хуков'),
      paragraph('Хуки — автоматические скрипты на события Claude Code. Настраиваются в `.claude/settings.json`:'),
      codeBlock('{\n  "hooks": {\n    "PostToolUse": [\n      {\n        "matcher": "Write|Edit",\n        "command": "prettier --write $FILEPATH"\n      }\n    ],\n    "PreToolUse": [\n      {\n        "matcher": "Bash",\n        "command": "bash .claude/hooks/destructive-guard.sh"\n      }\n    ]\n  }\n}', 'json'),
      paragraph('Основные триггеры:'),
      list([
        '`PreToolUse` — перед выполнением инструмента (Edit, Write, Bash)',
        '`PostToolUse` — после выполнения (форматирование, проверки)',
        '`Stop` — при завершении сессии (отчёты, уведомления)',
      ]),

      heading(2, 'Настройка правил'),
      paragraph('Правила живут в файлах `rules/*.md` и подключаются через CLAUDE.md. Начни с двух:'),
      list([
        '**anti-mirage.md** — проверка реальности: все файлы, функции, пакеты существуют',
        '**coding-standards.md** — стандарты кода: DRY, KISS, YAGNI, размеры файлов',
      ]),

      heading(2, 'Настройка плагинов'),
      paragraph('Плагины (MCP-серверы) подключаются в `~/.claude/settings.json` глобально:'),
      codeBlock('{\n  "mcpServers": {\n    "context7": {\n      "command": "npx",\n      "args": ["-y", "@context7/mcp-server"]\n    }\n  }\n}', 'json'),
      paragraph('Рекомендуемые плагины на старте:'),
      list([
        '`context7` — актуальная документация библиотек',
        '`typescript-lsp` — для TypeScript проектов',
        '`pyright-lsp` — для Python проектов',
      ]),

      heading(2, 'Минимальная конфигурация'),
      paragraph('Для начала достаточно:'),
      list([
        'CLAUDE.md в корне проекта (описание, стек, правила)',
        '2-3 хука (prettier, security-scan)',
        '1 правило (anti-mirage)',
        '1 плагин (context7)',
      ]),
      paragraph('Не перенастраивай. Добавляй инструменты по мере необходимости.'),

      heading(2, 'Частые проблемы'),
      list([
        '**«Хук не срабатывает»** — проверь путь к скрипту и права: `chmod +x script.sh`',
        '**«Плагин не подключается»** — перезапусти Claude Code после изменения settings.json',
        '**«Слишком много правил, Claude путается»** — сократи. 5-7 ключевых правил лучше, чем 50 размазанных',
      ]),
    ]),
  },

  {
    title: 'Первый проект',
    slug: 'pervyj-proekt',
    excerpt: 'Создаём первый проект с нуля: от идеи до деплоя. 7 фаз фреймворка в упрощённом виде для новичков.',
    pathOrder: 5,
    categorySlug: 'put-novichka',
    content: root([
      heading(2, 'Процесс создания проекта'),
      paragraph('Фреймворк описывает 7 фаз создания проекта. Для первого раза упрощаем до 5:'),
      list([
        '**Описание** — что делаем и для кого',
        '**Планирование** — какие файлы, какой стек',
        '**Реализация** — пишем код блоками',
        '**Тестирование** — проверяем, что работает',
        '**Деплой** — публикуем в интернет',
      ]),

      heading(2, 'Фаза 1: Опиши проект'),
      paragraph('Запусти Claude Code и опиши, что хочешь построить. Чем конкретнее — тем лучше:'),
      codeBlock('Хочу сделать Telegram-бот для учёта расходов.\n\nФункционал:\n- Пользователь отправляет сумму и категорию (\"500 еда\")\n- Бот сохраняет в БД\n- Команда /stats показывает расходы за месяц\n- Команда /categories показывает категории\n\nСтек: Python, aiogram v3, PostgreSQL, Docker\nДеплой: VPS', 'text'),
      paragraph('Claude задаст уточняющие вопросы — отвечай. Чем больше деталей, тем лучше результат.'),

      heading(2, 'Фаза 2: Планирование'),
      paragraph('Попроси Claude составить план. Он покажет структуру файлов и порядок работы:'),
      codeBlock('Составь план реализации. Покажи структуру проекта, \nкакие файлы создавать, в каком порядке.', 'text'),
      paragraph('Проверь план: файлы на месте, логика понятна, ничего лишнего. Скажи «делай» или скорректируй.'),

      heading(2, 'Фаза 3: Реализация'),
      paragraph('Claude будет работать **блоками** — по 1-3 файла за раз. После каждого блока — чекпоинт:'),
      list([
        'Файлы сохранены?',
        'Линтер не ругается?',
        'Базовые тесты проходят?',
      ]),
      paragraph('Если что-то сломалось — останови и скажи Claude. Не давай ему идти дальше с ошибкой.'),

      heading(2, 'Фаза 4: Тестирование'),
      paragraph('Минимальный набор тестов для первого проекта:'),
      list([
        '**Smoke-тест** — приложение запускается',
        '**Unit-тесты** — ключевые функции работают правильно',
        '**Ручная проверка** — пройди основной сценарий руками',
      ]),

      heading(2, 'Фаза 5: Деплой'),
      paragraph('Для первого деплоя используй Docker на VPS:'),
      list([
        'Собери Docker-образ',
        'Подними на VPS через docker-compose',
        'Настрой Nginx (если web) или просто запусти контейнер (если бот)',
        'Проверь, что работает',
      ]),

      heading(2, 'Советы для первого проекта'),
      list([
        '**Начни с малого** — бот, лендинг, простое API. Не Netflix',
        '**Не оптимизируй раньше времени** — сначала пусть работает, потом улучшай',
        '**Коммить часто** — каждый рабочий блок = коммит. Это страховка',
        '**Не бойся ошибок** — AI починит. Главное — описывай ошибку полностью',
      ]),

      heading(2, 'Частые проблемы'),
      list([
        '**«Docker не собирается»** — проверь Dockerfile, часто проблема в версии Node/Python',
        '**«Бот не отвечает на VPS»** — проверь TELEGRAM_BOT_TOKEN в .env и что контейнер запущен',
        '**«БД не подключается»** — проверь DATABASE_URL и что postgres-контейнер поднят',
        '**«Всё сломалось и я не знаю что делать»** — `git log`, найди последний рабочий коммит, `git checkout`',
      ]),
    ]),
  },

  {
    title: 'Продвинутые техники',
    slug: 'prodvinutye-tehniki',
    excerpt: 'Agent Teams, wave-параллелизм, cost-awareness. Инструменты для масштабирования вайбкодинга.',
    pathOrder: 6,
    categorySlug: 'put-novichka',
    content: root([
      heading(2, 'Agent Teams'),
      paragraph('Когда проект большой (эпик, несколько фич), один агент — бутылочное горлышко. Agent Teams позволяют запускать **несколько AI-агентов параллельно**:'),
      list([
        '**Team Lead** (Opus) — координирует, раздаёт задачи, проверяет результаты',
        '**Teammates** (Sonnet) — выполняют конкретные задачи параллельно',
        'Каждый teammate работает над своей частью проекта',
        'Lead собирает результаты и интегрирует',
      ]),
      paragraph('Это как менеджер проекта с командой разработчиков — только всё в одном терминале.'),

      heading(2, 'Wave-параллелизм'),
      paragraph('Группируй задачи в **волны** по зависимостям:'),
      codeBlock('Wave 1: Модели и миграции (фундамент)\n  └─ task-001, task-002 [параллельно]\n\nWave 2: Бизнес-логика\n  └─ task-003, task-004 [параллельно]\n\nWave 3: API и хендлеры\n  └─ task-005, task-006, task-007 [параллельно]\n\nWave 4: Интеграция и тесты\n  └─ task-008 [последовательно]', 'text'),
      paragraph('Задачи в одной волне независимы — их можно делать параллельно. Следующая волна начинается только после завершения предыдущей.'),

      heading(2, 'Cost-Awareness'),
      paragraph('AI стоит денег. Вот как оптимизировать расходы:'),
      list([
        '**Opus для мышления** — архитектура, планирование, ревью. Не для рутины',
        '**Sonnet для кода** — реализация, тесты, рефакторинг. Основной инструмент',
        '**Haiku для мелочей** — форматирование, простые проверки',
        '**Не грузи лишний контекст** — Claude читает только то, что нужно для текущей задачи',
        '**cost-tracker** — хук, который считает стоимость каждой сессии',
      ]),

      heading(2, 'Паттерны продвинутого вайбкодера'),

      heading(3, 'Atomic Commits'),
      paragraph('Один коммит = одно логическое изменение. Conventional Commits: `feat:`, `fix:`, `test:`, `refactor:`, `docs:`.'),

      heading(3, 'Бэклог вместо «потом»'),
      paragraph('Всё, что «потом» — в бэклог. Нерешённый вопрос, отложенный тест, идея — записывай. Ничего не теряется.'),

      heading(3, 'Максимум 3 итерации'),
      paragraph('Жёсткий лимит на любой цикл: валидация, ревью, auto-fix. После трёх — эскалация к человеку. Не позволяй AI крутиться в бесконечном цикле.'),

      heading(3, 'Context Files'),
      paragraph('Не грузи всё — грузи только то, что нужно для конкретной задачи. Экономит контекстное окно и улучшает фокус модели.'),

      heading(2, 'Частые проблемы'),
      list([
        '**«Teammates конфликтуют в git»** — каждый teammate должен работать над своими файлами. Планируй волны без пересечений',
        '**«Слишком дорого»** — переключи рутину на Sonnet, используй Opus только для планирования',
        '**«Agent Team запутался»** — скорее всего, задачи не были достаточно атомарными. Разбей мельче',
      ]),
    ]),
  },
]

/* =====================================================
   ФРЕЙМВОРК — 8 гайдов (pathOrder 7-14)
   ===================================================== */

const фреймворк: GuideData[] = [
  {
    title: 'Философия: Мозг + Руки',
    slug: 'framework-filosofiya',
    excerpt: 'Ключевая идея Vibe Framework: разделение на «что делать» (мозг/фреймворк) и «как делать» (руки/инструменты).',
    pathOrder: 7,
    categorySlug: 'framework',
    content: root([
      heading(2, 'Ключевая идея'),
      paragraph('Фреймворк разделяет **что делать** и **как делать**:'),
      list([
        '**Мозг (Фреймворк)** — живёт в CLAUDE.md, rules/, workflow-маркерах. Описывает ЧТО проверять, КОГДА запускать, КАКОЙ режим выбрать',
        '**Руки (Инструменты)** — hooks, agents, plugins, skills, commands. Выполняют конкретную работу: сканируют, форматируют, ревьюят',
      ]),

      heading(2, 'Зачем это нужно'),
      paragraph('Чистый промпт-инжиниринг — это когда ты пишешь простыню текста в CLAUDE.md и надеешься, что модель всё запомнит. Проблемы:'),
      list([
        'Контекстное окно конечно — промпт на 10к токенов жрёт место для полезной работы',
        'Модель «забывает» правила в длинных сессиях',
        'Нет гарантий выполнения — модель может проигнорировать инструкцию',
        'Нет автоматизации — всё ручное',
      ]),
      paragraph('**Мозг + Руки** решает это:'),
      list([
        'Правила минимальны — ссылаются на конкретные инструменты',
        'Hooks работают автоматически — не зависят от «настроения» модели',
        'Агенты подключаются по требованию — не забивают контекст постоянно',
        'Plugins дают доступ к реальным данным — LSP, grep, файловая система',
      ]),

      heading(2, 'Выбор модели'),
      list([
        '**Opus** — архитектура, планирование, сложная логика, ревью (5x дороже Sonnet)',
        '**Sonnet** — рутинная реализация, тесты, субагенты (базовая стоимость)',
        '**Haiku** — простые правки, форматирование, быстрые проверки (10x дешевле Sonnet)',
      ]),
      quote('Opus думает, Sonnet пишет, Haiku проверяет.'),
    ]),
  },

  {
    title: 'Четыре уровня работы',
    slug: 'chetyre-urovnya-raboty',
    excerpt: 'Проект, Эпик, Фича, Фикс — четыре масштаба задач в вайбкодинге. Каждый уровень определяет процесс.',
    pathOrder: 8,
    categorySlug: 'framework',
    content: root([
      heading(2, 'Иерархия уровней'),
      paragraph('Каждая задача попадает в один из четырёх уровней. Уровень определяет глубину процесса, набор инструментов и количество проверок.'),

      heading(3, 'Проект — создание с нуля'),
      paragraph('Полный цикл: инфраструктура, спецификация, архитектура, декомпозиция, реализация, тесты, деплой. Команда: `/new-project`. Все агенты задействованы.'),

      heading(3, 'Эпик — крупная функциональность'),
      paragraph('Набор связанных фич. Пример: «Система авторизации» = регистрация + логин + восстановление + профиль. Используется wave-параллелизм и Agent Teams.'),

      heading(3, 'Фича — одна возможность'),
      paragraph('Основная единица работы. Процесс: Brainstorm → Plan → Approve → Build → Test → Review → Commit. Команда: `/ship`.'),

      heading(3, 'Фикс — быстрое исправление'),
      paragraph('Что-то сломалось — чини. Определи → Исправь → Проверь. Команда: `/bug-fix`.'),

      heading(2, 'Как выбрать уровень'),
      list([
        '**Баг в одном файле** → Фикс',
        '**Новая кнопка, новый эндпоинт** → Фича',
        '**Система авторизации, переделка платежей** → Эпик',
        '**Новый продукт с нуля** → Проект',
      ]),
      paragraph('Если не уверен — начни с Фичи. Если задача вырастает — повысь уровень.'),

      heading(2, 'Что определяет уровень'),
      list([
        '**Глубину планирования** — Фикс без плана, Проект с полной спецификацией',
        '**Количество проверок** — Фикс: только тесты; Проект: 5 валидаторов параллельно',
        '**Набор агентов** — Фикс: 0-1; Проект: все доступные',
        '**Документацию** — Фикс: коммит-сообщение; Проект: user-spec + tech-spec + tasks',
      ]),
    ]),
  },

  {
    title: 'Уровень Проект: от нуля до продукта',
    slug: 'uroven-proekt',
    excerpt: '7 фаз создания проекта с нуля: инфраструктура, спецификация, архитектура, задачи, реализация, тесты, деплой.',
    pathOrder: 9,
    categorySlug: 'framework',
    content: root([
      heading(2, 'Обзор'),
      paragraph('Весь процесс запускается командой `/new-project` и идёт непрерывным потоком из 7 фаз. Между фазами нет ручного переключения — AI сам определяет готовность.'),

      heading(2, 'Фаза 0: Подготовка инфраструктуры'),
      paragraph('Поднять VPS, настроить безопасность, Docker, Nginx, SSL, CI/CD. Можно пропустить, если VPS уже настроен.'),
      list([
        'VPS с Ubuntu, пользователь deploy (не root!)',
        'Файрвол (ufw), fail2ban, SSH по ключу',
        'Docker + docker-compose',
        'Nginx как reverse proxy + SSL (Let\'s Encrypt)',
        'GitHub Actions для автодеплоя',
      ]),

      heading(2, 'Фаза 1: User Spec'),
      paragraph('Глубинное интервью с пользователем через субагента **business-analyst**. 7 циклов вопросов: общее понимание, user stories, UI/UX, данные, нефункциональные требования, edge-cases, деплой.'),
      paragraph('Валидация тремя валидаторами параллельно. Максимум 3 итерации.'),

      heading(2, 'Фаза 2: Tech Spec'),
      paragraph('Техническое интервью через субагента **system-analyst**. Стек, модель данных, безопасность, инфраструктура, масштабирование.'),
      paragraph('Валидация пятью валидаторами: skeptic, completeness, security, test-reviewer, tech-spec-validator.'),

      heading(2, 'Фаза 3: Декомпозиция'),
      paragraph('Разбить tech-spec на атомарные задачи. Каждая задача содержит: описание, пошаговый план, TDD-якорь, acceptance criteria, context files, ревьюеров.'),
      paragraph('Задачи группируются в **волны** по зависимостям для параллельного выполнения.'),

      heading(2, 'Фаза 4: Реализация'),
      paragraph('Два режима: последовательный (один агент) или командный (Agent Teams с wave-параллелизмом). TDD-цикл на каждую задачу: тесты → код → рефакторинг.'),

      heading(2, 'Фаза 5: Тестирование'),
      paragraph('AI анализирует проект и выбирает нужные типы тестов из 14 возможных. Обязательные: smoke, unit, integration, security, regression, UAT.'),

      heading(2, 'Фаза 6: Финализация'),
      paragraph('QA (тесты + линтер + тайпчек), деплой (Docker, миграции, мониторинг), post-deploy проверка, документация.'),
    ]),
  },

  {
    title: 'Уровень Эпик: крупная функциональность',
    slug: 'uroven-epik',
    excerpt: 'Эпик — набор связанных фич. Планирование, wave-параллелизм, Agent Teams, интеграция и QA.',
    pathOrder: 10,
    categorySlug: 'framework',
    content: root([
      heading(2, 'Что такое Эпик'),
      paragraph('Эпик — набор связанных фич, которые вместе дают пользователю новую возможность. Пример: «Система авторизации» = регистрация + логин + восстановление пароля + профиль.'),

      heading(2, 'Процесс'),
      paragraph('Планирование → Декомпозиция → Wave-параллелизм → Интеграция → Тестирование → QA'),

      heading(3, 'Шаг 1: Планирование'),
      list([
        'Опиши эпик в 2-3 предложениях (что получит пользователь)',
        'Запусти `planner` + `sequential-thinking` для архитектуры',
        'Определи scope: что входит, что НЕ входит (что НЕ входит → в Бэклог)',
      ]),

      heading(3, 'Шаг 2: Декомпозиция'),
      paragraph('Разбей эпик на 3-7 самодостаточных фич. Сгруппируй в волны по зависимостям.'),

      heading(3, 'Шаг 3: Wave-параллелизм'),
      paragraph('Для каждой волны запусти задачи параллельно (субагенты на Sonnet), дождись завершения, проведи интеграционную проверку, перейди к следующей.'),

      heading(3, 'Шаг 4: Интеграция'),
      list([
        'Запусти все тесты: unit + integration',
        'Проверь, что фичи работают вместе',
        'Запусти code-reviewer на весь diff эпика',
      ]),

      heading(3, 'Шаг 5: Тестирование и QA'),
      paragraph('Unit-тесты для новых модулей, integration для связей между фичами, security если эпик связан с авторизацией/данными. Regression — убедиться, что старый функционал не сломан.'),
    ]),
  },

  {
    title: 'Уровень Фича: одна возможность',
    slug: 'uroven-ficha',
    excerpt: 'Фича — основная единица работы вайбкодера. Brainstorm → Plan → Build → Test → Review → Commit.',
    pathOrder: 11,
    categorySlug: 'framework',
    content: root([
      heading(2, 'Что такое Фича'),
      paragraph('Основная единица работы. Даже если не работаешь на уровне проекта/эпика, каждая нетривиальная задача проходит через этот процесс.'),
      paragraph('Команда: `/ship`'),

      heading(2, 'Шаг 1: Brainstorming'),
      list([
        'Сформулируй, что именно нужно',
        'Определи scope и ограничения',
        'Если есть существующий код — изучи его через `mgrep`',
        'Используй `context7` для уточнения API библиотек',
      ]),

      heading(2, 'Шаг 2: Plan Mode'),
      paragraph('Claude входит в Plan Mode, исследует кодовую базу, предлагает план: затрагиваемые файлы, шаги, риски. Ты одобряешь или корректируешь.'),
      quote('Всегда проси Claude показать план ПЕРЕД реализацией. Это в 10 раз дешевле, чем переделывать код.'),

      heading(2, 'Шаг 3: Build (блоками)'),
      paragraph('Работай блоками по 1-3 файла. После каждого блока — чекпоинт: файлы сохранены, линтер проходит, тесты не сломались.'),
      paragraph('Автоматические проверки при каждом Edit/Write: security-scan, protect-secrets, prettier/ruff.'),

      heading(2, 'Шаг 4: Test'),
      paragraph('TDD-подход: напиши тест → запусти (красный) → напиши код → запусти (зелёный) → рефакторинг.'),

      heading(2, 'Шаг 5: Review'),
      paragraph('Автоматический код-ревью после >20 строк нового кода через `code-reviewer`. 10 измерений: корректность, безопасность, производительность, читаемость и др. Максимум 3 раунда фиксов.'),

      heading(2, 'Шаг 6: Commit'),
      paragraph('Conventional Commits: `feat(scope): описание`. Автоматические проверки: conventional-commit, branch-guard, security-scan.'),
    ]),
  },

  {
    title: 'Уровень Фикс: быстрое исправление',
    slug: 'uroven-fiks',
    excerpt: 'Quick Fix: определи проблему, исправь, проверь. Минимальный процесс для быстрых правок.',
    pathOrder: 12,
    categorySlug: 'framework',
    content: root([
      heading(2, 'Когда использовать'),
      paragraph('Фикс — когда что-то сломалось и надо починить. Или мелкая правка, не требующая планирования. Команда: `/bug-fix`.'),

      heading(2, 'Процесс: 3 шага'),

      heading(3, 'Шаг 1: Определи проблему'),
      paragraph('Скопируй **полный стектрейс** ошибки и отправь AI. Не пересказывай ошибку своими словами — потеряешь детали.'),
      paragraph('Используй `mgrep "ErrorMessage"` для поиска, где ошибка в коде.'),

      heading(3, 'Шаг 2: Исправь'),
      paragraph('Claude находит проблему, предлагает fix, применяет. Для сложных багов — systematic debugging:'),
      list([
        'Воспроизведи ошибку',
        'Добавь логирование в подозрительные места',
        'Сузь область поиска',
        'Исправь',
        'Удали дебаг-логи',
      ]),

      heading(3, 'Шаг 3: Проверь'),
      paragraph('Запусти тесты на затронутый модуль + regression (весь набор). Проверь линтером.'),

      heading(2, 'Когда повышать уровень'),
      list([
        'Баг требует изменения в **5+ файлах** → переходи на уровень Фича',
        'Баг в **архитектуре** → переходи на уровень Эпик',
        'Непонятно, **где баг** → systematic debugging, потом решай уровень',
      ]),
    ]),
  },

  {
    title: 'Quality Gates и Anti-Mirage',
    slug: 'quality-gates-i-anti-mirage',
    excerpt: 'Система автоматических проверок качества и защита от «галлюцинаций» AI. Что, чем и когда проверять.',
    pathOrder: 13,
    categorySlug: 'framework',
    content: root([
      heading(2, 'Quality Gates'),
      paragraph('Каждый gate привязан к конкретному инструменту. Часть работает автоматически (hooks), часть вызывается явно.'),

      heading(3, 'Автоматические проверки'),
      list([
        '**security-scan.sh** — безопасность при каждом Write/Edit',
        '**protect-secrets.sh** — защита секретов при каждом Write/Edit',
        '**destructive-guard.sh** — блокировка деструктивных команд в Bash',
        '**prettier / ruff** — форматирование JS/TS и Python',
        '**typescript-lsp / pyright-lsp** — проверка типов постоянно',
        '**code-simplifier** — упрощение кода после 3+ изменённых файлов',
      ]),

      heading(3, 'По вызову'),
      list([
        '**code-reviewer** — ревью после >20 строк нового кода',
        '**security-auditor** — OWASP аудит для security-sensitive кода',
        '**tdd-guide** — TDD-workflow для фич и эпиков',
        '**5 валидаторов** — для user-spec и tech-spec на уровне Проекта',
      ]),

      heading(3, 'Правило трёх попыток'),
      paragraph('На каждом уровне валидации максимум 3 итерации. После — эскалация к человеку.'),
      quote('Лучше ложно-положительное, чем ложно-отрицательное. Проверенная ошибка дешевле пропущенной.'),

      hr(),

      heading(2, 'Anti-Mirage'),
      paragraph('Claude любит «галлюцинировать» — ссылаться на несуществующие файлы, функции, API и пакеты. Anti-Mirage предотвращает это.'),

      heading(3, 'Правила проверки'),
      list([
        'Перед **ссылкой на файл** — проверь, что файл существует (`ls`, `find`, `mgrep`)',
        'Перед **вызовом функции** — проверь, что функция есть в кодовой базе',
        'Перед **импортом пакета** — проверь `package.json` / `pyproject.toml`',
        'Перед **ссылкой на поле БД** — проверь schema/migrations',
        'Перед **использованием API** — проверь документацию через `context7`',
        'Перед **упоминанием конфига** — проверь `.env.example` / config',
      ]),

      heading(3, 'Типичные миражи'),
      list([
        'Несуществующий файл: «Отредактируй `src/utils/helpers.py`» (его нет)',
        'Несуществующая функция: «Вызови `user.get_full_name()`» (метода нет)',
        'Устаревший API: «Используй `requests.get_async()`» (нет такого)',
        'Фантомный пакет: «Установи `fastapi-cache3`» (не существует)',
      ]),
    ]),
  },

  {
    title: 'Паттерны и приёмы вайбкодера',
    slug: 'patterny-vajbkodera',
    excerpt: '12 паттернов продуктивной работы с AI: от atomic commits до cost-awareness и бэклога.',
    pathOrder: 14,
    categorySlug: 'framework',
    content: root([
      heading(2, '12 паттернов'),

      heading(3, '1. Двунаправленная трассировка требований'),
      paragraph('Проверяй в обе стороны: каждое требование из user-spec отражено в tech-spec (forward), каждая задача обоснована требованием (reverse).'),

      heading(3, '2. TDD-якоря в спецификациях'),
      paragraph('Не жди фазы реализации — опиши тесты уже на уровне tech-spec. Это направляет реализацию и экономит время.'),

      heading(3, '3. Context Files (Just-in-Time загрузка)'),
      paragraph('Не грузи всё — грузи только то, что нужно для конкретной задачи. Экономит контекстное окно и улучшает фокус модели.'),

      heading(3, '4. Decisions.md — лог решений'),
      paragraph('Записывай, ПОЧЕМУ принял решение: контекст, альтернативы, выбор, последствия. Через 3 месяца не вспомнишь без записи.'),

      heading(3, '5. Wave-параллелизм'),
      paragraph('Группируй задачи в волны по зависимостям. Субагенты на Sonnet параллельно, Lead на Opus координирует.'),

      heading(3, '6. Максимум 3 итерации'),
      paragraph('Жёсткий лимит на любой цикл: валидация, ревью, auto-fix. После трёх — эскалация к человеку.'),

      heading(3, '7. Контекст после Compaction'),
      paragraph('Hook `reinject-context.sh` автоматически подгружает задачу, активные файлы и прогресс после сжатия контекста.'),

      heading(3, '8. Промпт = конкретика'),
      paragraph('Плохо: «Сделай авторизацию». Хорошо: конкретный стек, файлы, формат токенов, модели, пути.'),

      heading(3, '9. Cost-Awareness'),
      paragraph('Sonnet для рутины, Opus для сложного. Не грузи лишний контекст. `cost-tracker.sh` считает стоимость.'),

      heading(3, '10. Atomic Commits'),
      paragraph('Один коммит = одно логическое изменение. Conventional Commits: `feat`, `fix`, `test`, `refactor`, `docs`.'),

      heading(3, '11. Бэклог вместо «потом сделаю»'),
      paragraph('Всё, что «потом» — в бэклог. Нерешённый вопрос, отложенный тест, идея — записывай. Ничего не теряется.'),

      heading(3, '12. Глубинное интервью > Поверхностный бриф'),
      paragraph('Субагенты бизнес-аналитик и системный аналитик задают десятки вопросов, а не 3-4. Дорого по токенам, но на порядок дешевле переделывания.'),
    ]),
  },
]

/** Все гайды для seed */
export const guidesData: GuideData[] = [...путьНовичка, ...фреймворк]
